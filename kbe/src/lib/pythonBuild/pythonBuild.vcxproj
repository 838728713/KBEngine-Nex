<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|Win32">
      <Configuration>Debug</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|Win32">
      <Configuration>Release</Configuration>
      <Platform>Win32</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <VCProjectVersion>17.0</VCProjectVersion>
    <Keyword>Win32Proj</Keyword>
    <ProjectGuid>{78933a1c-a62a-4ecd-91e5-299d2fdf5d33}</ProjectGuid>
    <RootNamespace>pythonBuild</RootNamespace>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>true</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseDebugLibraries>false</UseDebugLibraries>
    <PlatformToolset>v143</PlatformToolset>
    <WholeProgramOptimization>true</WholeProgramOptimization>
    <CharacterSet>Unicode</CharacterSet>
  </PropertyGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <PropertyGroup Label="UserMacros" />
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>_DEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
    <PreBuildEvent>
      <Command>@echo off
setlocal enabledelayedexpansion

rem Step 1: 设置变量
set SOLUTION_DIR=$(SolutionDir)
set BUILD_SCRIPT=$(SolutionDir)lib\python\PCbuild\build.bat
set CONFIG=Debug

rem Step 2: 执行构建
echo [1] 正在构建 Python，调用 build.bat -c %CONFIG% ...
call "%BUILD_SCRIPT%" -c %CONFIG%
if errorlevel 1 (
    echo [ERROR] 构建失败，终止脚本。
)

rem Step 3: 设置文件路径
set OUT_DIR=%SOLUTION_DIR%lib\python\PCbuild\amd64
set python313_d_LIB_FILE=python313_d.lib
set python313_d_EXP_FILE=python313_d.exp

set python313_d_DLL_FILE=python313_d.dll
set python313_d_ILK_FILE=python313_d.ilk
set python313_d_PDB_FILE=python313_d.pdb

set vcruntime140_FILE=vcruntime140.dll
set vcruntime140_1_FILE=vcruntime140_1.dll

set TARGET_LIB_DIR=$(SolutionDir)libs
set TARGET_DLL_DIR=$(SolutionDir)..\bin\server

rem Step 4: 创建目标目录（如不存在）
if not exist "%TARGET_LIB_DIR%" (
    mkdir "%TARGET_LIB_DIR%"
)
if not exist "%TARGET_DLL_DIR%" (
    mkdir "%TARGET_DLL_DIR%"
)

rem Step 5: 拷贝 lib 文件
echo [2] 正在复制 %python313_d_LIB_FILE% 到 %TARGET_LIB_DIR%
copy /Y "%OUT_DIR%\%python313_d_LIB_FILE%" "%TARGET_LIB_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %python313_d_LIB_FILE% 文件失败。
)
echo [2] 正在复制 %python313_d_EXP_FILE% 到 %TARGET_LIB_DIR%
copy /Y "%OUT_DIR%\%python313_d_EXP_FILE%" "%TARGET_LIB_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %python313_d_EXP_FILE% 文件失败。
)

rem Step 6: 拷贝 dll 文件
echo [3] 正在复制 %python313_d_DLL_FILE% 到 %TARGET_DLL_DIR%
copy /Y "%OUT_DIR%\%python313_d_DLL_FILE%" "%TARGET_DLL_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %python313_d_LIB_FILE% 文件失败。
)

echo [4] 正在复制 %python313_d_ILK_FILE% 到 %TARGET_DLL_DIR%
copy /Y "%OUT_DIR%\%python313_d_ILK_FILE%" "%TARGET_DLL_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %python313_d_ILK_FILE% 文件失败。
)

echo [5] 正在复制 %python313_d_PDB_FILE% 到 %TARGET_DLL_DIR%
copy /Y "%OUT_DIR%\%python313_d_PDB_FILE%" "%TARGET_DLL_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %python313_d_PDB_FILE% 文件失败。
)


echo [6] 正在复制 %vcruntime140_FILE% 到 %TARGET_DLL_DIR%
copy /Y "%OUT_DIR%\%vcruntime140_FILE%" "%TARGET_DLL_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %vcruntime140_FILE% 文件失败。
)


echo [7] 正在复制 %vcruntime140_1_FILE% 到 %TARGET_DLL_DIR%
copy /Y "%OUT_DIR%\%vcruntime140_1_FILE%" "%TARGET_DLL_DIR%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %vcruntime140_1_FILE% 文件失败。
)


set LIBS_DIR=%SOLUTION_DIR%lib\python\Lib
set OUT_LIBS_DIR=%~dp0..\res\scripts\common\Lib
set OUT_DLLS_DIR=%~dp0..\res\scripts\common\DLLs

echo [8] 正在复制 %LIBS_DIR% 到 %OUT_LIBS_DIR%

xcopy %LIBS_DIR% %OUT_LIBS_DIR% /Y /i /e



echo [9] 正在复制 %OUT_DIR% 到 %OUT_DLLS_DIR%

xcopy %OUT_DIR% %OUT_DLLS_DIR% /Y /i /e



set pyconfig=%SOLUTION_DIR%lib\python\PCbuild\amd64\pyconfig.h
set out_pyconfig=%SOLUTION_DIR%lib\python\Include

echo [10] 正在复制 %pyconfig% 到 %out_pyconfig%
copy /Y "%pyconfig%" "%out_pyconfig%"
if errorlevel 1 (
    echo [ERROR] 拷贝 %pyconfig% 文件失败。
)


echo 操作完成 
</Command>
    </PreBuildEvent>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <WarningLevel>Level3</WarningLevel>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <GenerateDebugInformation>true</GenerateDebugInformation>
    </Link>
  </ItemDefinitionGroup>
  <ItemGroup>
  </ItemGroup>
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>